{"version":3,"file":"view.min.js","sources":["../src/view.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Manage the courses view for the my overview with search block.\n *\n * @copyright  2022 Kacper Rokicki <k.k.rokicki@gmail.com>\n * @copyright  based on work by 2018 Bas Brands <bas@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(\n[\n    'jquery',\n    'block_myoverview_withsearch/repository',\n    'core/paged_content_factory',\n    'core/pubsub',\n    'core/custom_interaction_events',\n    'core/notification',\n    'core/templates',\n    'core_course/events',\n    'block_myoverview_withsearch/selectors',\n    'core/paged_content_events',\n    'core/aria',\n],\nfunction(\n    $,\n    Repository,\n    PagedContentFactory,\n    PubSub,\n    CustomEvents,\n    Notification,\n    Templates,\n    CourseEvents,\n    Selectors,\n    PagedContentEvents,\n    Aria\n) {\n\n    var SELECTORS = {\n        COURSE_REGION: '[data-region=\"course-view-content\"]',\n        ACTION_HIDE_COURSE: '[data-action=\"hide-course\"]',\n        ACTION_SHOW_COURSE: '[data-action=\"show-course\"]',\n        ACTION_ADD_FAVOURITE: '[data-action=\"add-favourite\"]',\n        ACTION_REMOVE_FAVOURITE: '[data-action=\"remove-favourite\"]',\n        FAVOURITE_ICON: '[data-region=\"favourite-icon\"]',\n        ICON_IS_FAVOURITE: '[data-region=\"is-favourite\"]',\n        ICON_NOT_FAVOURITE: '[data-region=\"not-favourite\"]',\n        PAGED_CONTENT_CONTAINER: '[data-region=\"page-container\"]'\n\n    };\n\n    var TEMPLATES = {\n        COURSES_CARDS: 'block_myoverview_withsearch/view-cards',\n        COURSES_LIST: 'block_myoverview_withsearch/view-list',\n        COURSES_SUMMARY: 'block_myoverview_withsearch/view-summary',\n        NOCOURSES: 'core_course/no-courses'\n    };\n\n    var GROUPINGS = {\n        GROUPING_ALLINCLUDINGHIDDEN: 'allincludinghidden',\n        GROUPING_ALL: 'all',\n        GROUPING_INPROGRESS: 'inprogress',\n        GROUPING_FUTURE: 'future',\n        GROUPING_PAST: 'past',\n        GROUPING_FAVOURITES: 'favourites',\n        GROUPING_HIDDEN: 'hidden'\n    };\n\n    var NUMCOURSES_PERPAGE = [12, 24, 48, 96, 0];\n\n    var loadedPages = [];\n\n    var courseOffset = 0;\n\n    var lastPage = 0;\n\n    var lastLimit = 0;\n\n    var namespace = null;\n\n    /**\n     * Get filter values from DOM.\n     *\n     * @param {object} root The root element for the courses view.\n     * @return {filters} Set filters.\n     */\n    var getFilterValues = function(root) {\n        var courseRegion = root.find(Selectors.courseView.region);\n        var search = document.getElementById('myoverview_withsearch-searchbar').value;\n        return {\n            display: courseRegion.attr('data-display'),\n            grouping: courseRegion.attr('data-grouping'),\n            sort: courseRegion.attr('data-sort'),\n            displaycategories: courseRegion.attr('data-displaycategories'),\n            customfieldname: courseRegion.attr('data-customfieldname'),\n            customfieldvalue: courseRegion.attr('data-customfieldvalue'),\n            search: search.length > 0 ? search : null\n        };\n    };\n\n    // We want the paged content controls below the paged content area.\n    // and the controls should be ignored while data is loading.\n    var DEFAULT_PAGED_CONTENT_CONFIG = {\n        ignoreControlWhileLoading: true,\n        controlPlacementBottom: true,\n        persistentLimitKey: 'block_myoverview_withsearch_user_paging_preference'\n    };\n\n    /**\n     * Get enrolled courses from backend.\n     *\n     * @param {object} filters The filters for this view.\n     * @param {int} limit The number of courses to show.\n     * @return {promise} Resolved with an array of courses.\n     */\n    var getMyCourses = function(filters, limit) {\n\n        return Repository.getEnrolledCoursesByTimeline({\n            offset: courseOffset,\n            limit: limit,\n            classification: filters.grouping,\n            sort: filters.sort,\n            customfieldname: filters.customfieldname,\n            customfieldvalue: filters.customfieldvalue,\n            search: filters.search\n        });\n    };\n\n    /**\n     * Get the container element for the favourite icon.\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     * @return {Object} The favourite icon container\n     */\n    var getFavouriteIconContainer = function(root, courseId) {\n        return root.find(SELECTORS.FAVOURITE_ICON + '[data-course-id=\"' + courseId + '\"]');\n    };\n\n    /**\n     * Get the paged content container element.\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} index Rendered page index.\n     * @return {Object} The rendered paged container.\n     */\n    var getPagedContentContainer = function(root, index) {\n        return root.find('[data-region=\"paged-content-page\"][data-page=\"' + index + '\"]');\n    };\n\n    /**\n     * Get the course id from a favourite element.\n     *\n     * @param {Object} root The favourite icon container element.\n     * @return {Number} Course id.\n     */\n    var getCourseId = function(root) {\n        return root.attr('data-course-id');\n    };\n\n    /**\n     * Hide the favourite icon.\n     *\n     * @param {Object} root The favourite icon container element.\n     * @param  {Number} courseId Course id number.\n     */\n    var hideFavouriteIcon = function(root, courseId) {\n        var iconContainer = getFavouriteIconContainer(root, courseId);\n\n        var isFavouriteIcon = iconContainer.find(SELECTORS.ICON_IS_FAVOURITE);\n        isFavouriteIcon.addClass('hidden');\n        Aria.hide(isFavouriteIcon);\n\n        var notFavourteIcon = iconContainer.find(SELECTORS.ICON_NOT_FAVOURITE);\n        notFavourteIcon.removeClass('hidden');\n        Aria.unhide(notFavourteIcon);\n    };\n\n    /**\n     * Show the favourite icon.\n     *\n     * @param  {Object} root The course overview container.\n     * @param  {Number} courseId Course id number.\n     */\n    var showFavouriteIcon = function(root, courseId) {\n        var iconContainer = getFavouriteIconContainer(root, courseId);\n\n        var isFavouriteIcon = iconContainer.find(SELECTORS.ICON_IS_FAVOURITE);\n        isFavouriteIcon.removeClass('hidden');\n        Aria.unhide(isFavouriteIcon);\n\n        var notFavourteIcon = iconContainer.find(SELECTORS.ICON_NOT_FAVOURITE);\n        notFavourteIcon.addClass('hidden');\n        Aria.hide(notFavourteIcon);\n    };\n\n    /**\n     * Get the action menu item\n     *\n     * @param {Object} root  root The course overview container\n     * @param {Number} courseId Course id.\n     * @return {Object} The add to favourite menu item.\n     */\n    var getAddFavouriteMenuItem = function(root, courseId) {\n        return root.find('[data-action=\"add-favourite\"][data-course-id=\"' + courseId + '\"]');\n    };\n\n    /**\n     * Get the action menu item\n     *\n     * @param {Object} root  root The course overview container\n     * @param {Number} courseId Course id.\n     * @return {Object} The remove from favourites menu item.\n     */\n    var getRemoveFavouriteMenuItem = function(root, courseId) {\n        return root.find('[data-action=\"remove-favourite\"][data-course-id=\"' + courseId + '\"]');\n    };\n\n    /**\n     * Add course to favourites\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     */\n    var addToFavourites = function(root, courseId) {\n        var removeAction = getRemoveFavouriteMenuItem(root, courseId);\n        var addAction = getAddFavouriteMenuItem(root, courseId);\n\n        setCourseFavouriteState(courseId, true).then(function(success) {\n            if (success) {\n                PubSub.publish(CourseEvents.favourited, courseId);\n                removeAction.removeClass('hidden');\n                addAction.addClass('hidden');\n                showFavouriteIcon(root, courseId);\n            } else {\n                Notification.alert('Starring course failed', 'Could not change favourite state');\n            }\n            return;\n        }).catch(Notification.exception);\n    };\n\n    /**\n     * Remove course from favourites\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     */\n    var removeFromFavourites = function(root, courseId) {\n        var removeAction = getRemoveFavouriteMenuItem(root, courseId);\n        var addAction = getAddFavouriteMenuItem(root, courseId);\n\n        setCourseFavouriteState(courseId, false).then(function(success) {\n            if (success) {\n                PubSub.publish(CourseEvents.unfavorited, courseId);\n                removeAction.addClass('hidden');\n                addAction.removeClass('hidden');\n                hideFavouriteIcon(root, courseId);\n            } else {\n                Notification.alert('Starring course failed', 'Could not change favourite state');\n            }\n            return;\n        }).catch(Notification.exception);\n    };\n\n    /**\n     * Get the action menu item\n     *\n     * @param {Object} root  root The course overview container\n     * @param {Number} courseId Course id.\n     * @return {Object} The hide course menu item.\n     */\n    var getHideCourseMenuItem = function(root, courseId) {\n        return root.find('[data-action=\"hide-course\"][data-course-id=\"' + courseId + '\"]');\n    };\n\n    /**\n     * Get the action menu item\n     *\n     * @param {Object} root  root The course overview container\n     * @param {Number} courseId Course id.\n     * @return {Object} The show course menu item.\n     */\n    var getShowCourseMenuItem = function(root, courseId) {\n        return root.find('[data-action=\"show-course\"][data-course-id=\"' + courseId + '\"]');\n    };\n\n    /**\n     * Hide course\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     */\n    var hideCourse = function(root, courseId) {\n        var hideAction = getHideCourseMenuItem(root, courseId);\n        var showAction = getShowCourseMenuItem(root, courseId);\n        var filters = getFilterValues(root);\n\n        setCourseHiddenState(courseId, true);\n\n        // Remove the course from this view as it is now hidden and thus not covered by this view anymore.\n        // Do only if we are not in \"All\" view mode where really all courses are shown.\n        if (filters.grouping != GROUPINGS.GROUPING_ALLINCLUDINGHIDDEN) {\n            hideElement(root, courseId);\n        }\n\n        hideAction.addClass('hidden');\n        showAction.removeClass('hidden');\n    };\n\n    /**\n     * Show course\n     *\n     * @param  {Object} root The course overview container\n     * @param  {Number} courseId Course id number\n     */\n    var showCourse = function(root, courseId) {\n        var hideAction = getHideCourseMenuItem(root, courseId);\n        var showAction = getShowCourseMenuItem(root, courseId);\n        var filters = getFilterValues(root);\n\n        setCourseHiddenState(courseId, null);\n\n        // Remove the course from this view as it is now shown again and thus not covered by this view anymore.\n        // Do only if we are not in \"All\" view mode where really all courses are shown.\n        if (filters.grouping != GROUPINGS.GROUPING_ALLINCLUDINGHIDDEN) {\n            hideElement(root, courseId);\n        }\n\n        hideAction.removeClass('hidden');\n        showAction.addClass('hidden');\n    };\n\n    /**\n     * Set the courses hidden status and push to repository\n     *\n     * @param  {Number} courseId Course id to favourite.\n     * @param  {Bool} status new hidden status.\n     * @return {Promise} Repository promise.\n     */\n    var setCourseHiddenState = function(courseId, status) {\n\n        // If the given status is not hidden, the preference has to be deleted with a null value.\n        if (status === false) {\n            status = null;\n        }\n        return Repository.updateUserPreferences({\n            preferences: [\n                {\n                    type: 'block_myoverview_withsearch_hidden_course_' + courseId,\n                    value: status\n                }\n            ]\n        });\n    };\n\n    /**\n     * Reset the loadedPages dataset to take into account the hidden element\n     *\n     * @param {Object} root The course overview container\n     * @param {Number} id The course id number\n     */\n    var hideElement = function(root, id) {\n        var pagingBar = root.find('[data-region=\"paging-bar\"]');\n        var jumpto = parseInt(pagingBar.attr('data-active-page-number'));\n\n        // Get a reduced dataset for the current page.\n        var courseList = loadedPages[jumpto];\n        var reducedCourse = courseList.courses.reduce(function(accumulator, current) {\n            if (id != current.id) {\n                accumulator.push(current);\n            }\n            return accumulator;\n        }, []);\n\n        // Get the next page's data if loaded and pop the first element from it\n        if (loadedPages[jumpto + 1] != undefined) {\n            var newElement = loadedPages[jumpto + 1].courses.slice(0, 1);\n\n            // Adjust the dataset for the reset of the pages that are loaded\n            loadedPages.forEach(function(courseList, index) {\n                if (index > jumpto) {\n                    var popElement = [];\n                    if (loadedPages[index + 1] != undefined) {\n                        popElement = loadedPages[index + 1].courses.slice(0, 1);\n                    }\n\n                    loadedPages[index].courses = $.merge(loadedPages[index].courses.slice(1), popElement);\n                }\n            });\n\n\n            reducedCourse = $.merge(reducedCourse, newElement);\n        }\n\n        // Check if the next page is the last page and if it still has data associated to it\n        if (lastPage == jumpto + 1 && loadedPages[jumpto + 1].courses.length == 0) {\n            var pagedContentContainer = root.find('[data-region=\"paged-content-container\"]');\n            PagedContentFactory.resetLastPageNumber($(pagedContentContainer).attr('id'), jumpto);\n        }\n\n        loadedPages[jumpto].courses = reducedCourse;\n\n        // Reduce the course offset\n        courseOffset--;\n\n        // Render the paged content for the current\n        var pagedContentPage = getPagedContentContainer(root, jumpto);\n        renderCourses(root, loadedPages[jumpto]).then(function(html, js) {\n            return Templates.replaceNodeContents(pagedContentPage, html, js);\n        }).catch(Notification.exception);\n\n        // Delete subsequent pages in order to trigger the callback\n        loadedPages.forEach(function(courseList, index) {\n            if (index > jumpto) {\n                var page = getPagedContentContainer(root, index);\n                page.remove();\n            }\n        });\n    };\n\n    /**\n     * Set the courses favourite status and push to repository\n     *\n     * @param  {Number} courseId Course id to favourite.\n     * @param  {Bool} status new favourite status.\n     * @return {Promise} Repository promise.\n     */\n    var setCourseFavouriteState = function(courseId, status) {\n\n        return Repository.setFavouriteCourses({\n            courses: [\n                    {\n                        'id': courseId,\n                        'favourite': status\n                    }\n                ]\n        }).then(function(result) {\n            if (result.warnings.length == 0) {\n                loadedPages.forEach(function(courseList) {\n                    courseList.courses.forEach(function(course, index) {\n                        if (course.id == courseId) {\n                            courseList.courses[index].isfavourite = status;\n                        }\n                    });\n                });\n                return true;\n            } else {\n                return false;\n            }\n        }).catch(Notification.exception);\n    };\n\n    /**\n     * Render the dashboard courses.\n     *\n     * @param {object} root The root element for the courses view.\n     * @param {array} coursesData containing array of returned courses.\n     * @return {promise} jQuery promise resolved after rendering is complete.\n     */\n    var renderCourses = function(root, coursesData) {\n\n        var filters = getFilterValues(root);\n\n        var currentTemplate = '';\n        if (filters.display == 'card') {\n            currentTemplate = TEMPLATES.COURSES_CARDS;\n        } else if (filters.display == 'list') {\n            currentTemplate = TEMPLATES.COURSES_LIST;\n        } else {\n            currentTemplate = TEMPLATES.COURSES_SUMMARY;\n        }\n\n        // Whether the course category should be displayed in the course item.\n        coursesData.courses = coursesData.courses.map(function(course) {\n            course.showcoursecategory = filters.displaycategories == 'on' ? true : false;\n            return course;\n        });\n\n        if (coursesData.courses.length) {\n            return Templates.render(currentTemplate, {\n                courses: coursesData.courses,\n            });\n        } else {\n            var nocoursesimg = root.find(Selectors.courseView.region).attr('data-nocoursesimg');\n            return Templates.render(TEMPLATES.NOCOURSES, {\n                nocoursesimg: nocoursesimg\n            });\n        }\n    };\n\n    /**\n     * Return the callback to be passed to the subscribe event\n     *\n     * @param {Number} limit The paged limit that is passed through the event\n     */\n    var setLimit = function(limit) {\n        this.find(Selectors.courseView.region).attr('data-paging', limit);\n    };\n\n    /**\n     * Intialise the paged list and cards views on page load.\n     * Returns an array of paged contents that we would like to handle here\n     *\n     * @param {object} root The root element for the courses view\n     * @param {string} namespace The namespace for all the events attached\n     */\n    var registerPagedEventHandlers = function(root, namespace) {\n        var event = namespace + PagedContentEvents.SET_ITEMS_PER_PAGE_LIMIT;\n        PubSub.subscribe(event, setLimit.bind(root));\n    };\n\n    /**\n     * Intialise the courses list and cards views on page load.\n     *\n     * @param {object} root The root element for the courses view.\n     */\n    var initializePagedContent = function(root) {\n        namespace = \"block_myoverview_withsearch_\" + root.attr('id') + \"_\" + Math.random();\n\n        var pagingLimit = parseInt(root.find(Selectors.courseView.region).attr('data-paging'), 10);\n        var itemsPerPage = NUMCOURSES_PERPAGE.map(function(value) {\n            var active = false;\n            if (value == pagingLimit) {\n                active = true;\n            }\n\n            return {\n                value: value,\n                active: active\n            };\n        });\n\n        // Filter out all pagination options which are too large for the amount of courses user is enrolled in.\n        var totalCourseCount = parseInt(root.find(Selectors.courseView.region).attr('data-totalcoursecount'), 10);\n        itemsPerPage = itemsPerPage.filter(function(pagingOption) {\n            return pagingOption.value < totalCourseCount || pagingOption.value === 0;\n        });\n\n        var filters = getFilterValues(root);\n        var config = $.extend({}, DEFAULT_PAGED_CONTENT_CONFIG);\n        config.eventNamespace = namespace;\n\n        var pagedContentPromise = PagedContentFactory.createWithLimit(\n            itemsPerPage,\n            function(pagesData, actions) {\n                var promises = [];\n\n                pagesData.forEach(function(pageData) {\n                    var currentPage = pageData.pageNumber;\n                    var limit = (pageData.limit > 0) ? pageData.limit : 0;\n\n                    // Reset local variables if limits have changed\n                    if (lastLimit != limit) {\n                        loadedPages = [];\n                        courseOffset = 0;\n                        lastPage = 0;\n                    }\n\n                    if (lastPage == currentPage) {\n                        // If we are on the last page and have it's data then load it from cache\n                        actions.allItemsLoaded(lastPage);\n                        promises.push(renderCourses(root, loadedPages[currentPage]));\n                        return;\n                    }\n\n                    lastLimit = limit;\n\n                    // Get 2 pages worth of data as we will need it for the hidden functionality.\n                    if (loadedPages[currentPage + 1] == undefined) {\n                        if (loadedPages[currentPage] == undefined) {\n                            limit *= 2;\n                        }\n                    }\n\n                    var pagePromise = getMyCourses(\n                        filters,\n                        limit\n                    ).then(function(coursesData) {\n                        var courses = coursesData.courses;\n                        var nextPageStart = 0;\n                        var pageCourses = [];\n\n                        // If current page's data is loaded make sure we max it to page limit\n                        if (loadedPages[currentPage] != undefined) {\n                            pageCourses = loadedPages[currentPage].courses;\n                            var currentPageLength = pageCourses.length;\n                            if (currentPageLength < pageData.limit) {\n                                nextPageStart = pageData.limit - currentPageLength;\n                                pageCourses = $.merge(loadedPages[currentPage].courses, courses.slice(0, nextPageStart));\n                            }\n                        } else {\n                            // When the page limit is zero, there is only one page of courses, no start for next page.\n                            nextPageStart = pageData.limit || false;\n                            pageCourses = (pageData.limit > 0) ? courses.slice(0, pageData.limit) : courses;\n                        }\n\n                        // Finished setting up the current page\n                        loadedPages[currentPage] = {\n                            courses: pageCourses\n                        };\n\n                        // Set up the next page (if there is more than one page).\n                        var remainingCourses = nextPageStart !== false ? courses.slice(nextPageStart, courses.length) : [];\n                        if (remainingCourses.length) {\n                            loadedPages[currentPage + 1] = {\n                                courses: remainingCourses\n                            };\n                        }\n\n                        // Set the last page to either the current or next page\n                        if (loadedPages[currentPage].courses.length < pageData.limit || !remainingCourses.length) {\n                            lastPage = currentPage;\n                            actions.allItemsLoaded(currentPage);\n                        } else if (loadedPages[currentPage + 1] != undefined\n                            && loadedPages[currentPage + 1].courses.length < pageData.limit) {\n                            lastPage = currentPage + 1;\n                        }\n\n                        courseOffset = coursesData.nextoffset;\n                        return renderCourses(root, loadedPages[currentPage]);\n                    })\n                    .catch(Notification.exception);\n\n                    promises.push(pagePromise);\n                });\n\n                return promises;\n            },\n            config\n        );\n\n        pagedContentPromise.then(function(html, js) {\n            registerPagedEventHandlers(root, namespace);\n            return Templates.replaceNodeContents(root.find(Selectors.courseView.region), html, js);\n        }).catch(Notification.exception);\n    };\n\n    /**\n     * Listen to, and handle events for  the myoverview_withsearch block.\n     *\n     * @param {Object} root The myoverview_withsearch block container element.\n     */\n    var registerEventListeners = function(root) {\n        CustomEvents.define(root, [\n            CustomEvents.events.activate\n        ]);\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTION_ADD_FAVOURITE, function(e, data) {\n            var favourite = $(e.target).closest(SELECTORS.ACTION_ADD_FAVOURITE);\n            var courseId = getCourseId(favourite);\n            addToFavourites(root, courseId);\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTION_REMOVE_FAVOURITE, function(e, data) {\n            var favourite = $(e.target).closest(SELECTORS.ACTION_REMOVE_FAVOURITE);\n            var courseId = getCourseId(favourite);\n            removeFromFavourites(root, courseId);\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.FAVOURITE_ICON, function(e, data) {\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTION_HIDE_COURSE, function(e, data) {\n            var target = $(e.target).closest(SELECTORS.ACTION_HIDE_COURSE);\n            var courseId = getCourseId(target);\n            hideCourse(root, courseId);\n            data.originalEvent.preventDefault();\n        });\n\n        root.on(CustomEvents.events.activate, SELECTORS.ACTION_SHOW_COURSE, function(e, data) {\n            var target = $(e.target).closest(SELECTORS.ACTION_SHOW_COURSE);\n            var courseId = getCourseId(target);\n            showCourse(root, courseId);\n            data.originalEvent.preventDefault();\n        });\n\n        const debounce = (func, timeout = 1000) => {\n            let timer;\n            return (...args) => {\n                clearTimeout(timer);\n                timer = setTimeout(() => {\n                    func.apply(this, args);\n                }, timeout);\n            };\n        };\n\n        const applySearch = () => {\n            init(root);\n        };\n\n        const handleChange = debounce(() => applySearch());\n\n        document.getElementById('clearsearch').addEventListener('click', function() {\n            document.getElementById('myoverview_withsearch-searchbar').value = '';\n            document.getElementById('clearsearch').style.visibility = 'hidden';\n            applySearch();\n        });\n\n        document.getElementById('myoverview_withsearch-searchbar').addEventListener('input', function() {\n            const value = document.getElementById('myoverview_withsearch-searchbar').value;\n            document.getElementById('clearsearch').style.visibility = value.length === 0 ? 'hidden' : '';\n            handleChange();\n        });\n    };\n\n    /**\n     * Intialise the courses list and cards views on page load.\n     *\n     * @param {object} root The root element for the courses view.\n     */\n    var init = function(root) {\n        root = $(root);\n        loadedPages = [];\n        lastPage = 0;\n        courseOffset = 0;\n\n        initializePagedContent(root);\n\n        if (!root.attr('data-init')) {\n            registerEventListeners(root);\n            root.attr('data-init', true);\n        }\n    };\n\n    /**\n     * Reset the courses views to their original\n     *\n     * state on first page load.courseOffset\n     *\n     * This is called when configuration has changed for the event lists\n     * to cause them to reload their data.\n     *\n     * @param {Object} root The root element for the timeline view.\n     */\n    var reset = function(root) {\n        if (loadedPages.length > 0) {\n            loadedPages.forEach(function(courseList, index) {\n                var pagedContentPage = getPagedContentContainer(root, index);\n                renderCourses(root, courseList).then(function(html, js) {\n                    return Templates.replaceNodeContents(pagedContentPage, html, js);\n                }).catch(Notification.exception);\n            });\n        } else {\n            init(root);\n        }\n    };\n\n    return {\n        init: init,\n        reset: reset\n    };\n});\n"],"names":["define","$","Repository","PagedContentFactory","PubSub","CustomEvents","Notification","Templates","CourseEvents","Selectors","PagedContentEvents","Aria","SELECTORS","TEMPLATES","GROUPINGS","NUMCOURSES_PERPAGE","loadedPages","courseOffset","lastPage","lastLimit","namespace","getFilterValues","root","courseRegion","find","courseView","region","search","document","getElementById","value","display","attr","grouping","sort","displaycategories","customfieldname","customfieldvalue","length","DEFAULT_PAGED_CONTENT_CONFIG","ignoreControlWhileLoading","controlPlacementBottom","persistentLimitKey","getFavouriteIconContainer","courseId","getPagedContentContainer","index","getCourseId","getAddFavouriteMenuItem","getRemoveFavouriteMenuItem","addToFavourites","removeAction","addAction","setCourseFavouriteState","then","success","publish","favourited","removeClass","addClass","iconContainer","isFavouriteIcon","unhide","notFavourteIcon","hide","showFavouriteIcon","alert","catch","exception","removeFromFavourites","unfavorited","hideFavouriteIcon","getHideCourseMenuItem","getShowCourseMenuItem","setCourseHiddenState","status","updateUserPreferences","preferences","type","hideElement","id","pagingBar","jumpto","parseInt","reducedCourse","courses","reduce","accumulator","current","push","undefined","newElement","slice","forEach","courseList","popElement","merge","pagedContentContainer","resetLastPageNumber","pagedContentPage","renderCourses","html","js","replaceNodeContents","remove","setFavouriteCourses","result","warnings","course","isfavourite","coursesData","filters","currentTemplate","map","showcoursecategory","render","nocoursesimg","setLimit","limit","registerPagedEventHandlers","event","SET_ITEMS_PER_PAGE_LIMIT","subscribe","bind","initializePagedContent","Math","random","pagingLimit","itemsPerPage","active","totalCourseCount","filter","pagingOption","config","extend","eventNamespace","pagedContentPromise","createWithLimit","pagesData","actions","promises","pageData","currentPage","pageNumber","allItemsLoaded","pagePromise","getEnrolledCoursesByTimeline","offset","classification","getMyCourses","nextPageStart","pageCourses","currentPageLength","remainingCourses","nextoffset","registerEventListeners","events","activate","on","e","data","favourite","target","closest","originalEvent","preventDefault","hideAction","showAction","hideCourse","showCourse","applySearch","init","handleChange","func","timer","timeout","args","clearTimeout","setTimeout","apply","_this","debounce","addEventListener","style","visibility","reset"],"mappings":"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"}